{"ast":null,"code":"import { useEffect, useRef } from 'react';\nimport { useFormState } from 'react-final-form';\nimport { useHistory } from 'react-router-dom';\nimport { useTranslate } from '../i18n';\n/**\n * Display a confirmation dialog if the form has unsaved changes.\n * - If the user confirms, the navigation continues and the changes are lost.\n * - If the user cancels, the navigation is cancelled and the changes are kept.\n */\n\nvar useWarnWhenUnsavedChanges = function (enable, formRootPathname) {\n  var history = useHistory();\n  var translate = useTranslate();\n  var pristine = useFormState(UseFormStateSubscription).pristine;\n  var initialLocation = useRef(formRootPathname || history.location.pathname);\n  useEffect(function () {\n    if (!enable) {\n      return;\n    }\n\n    var release = history.block(function (location) {\n      var isInsideForm = location.pathname.startsWith(initialLocation.current);\n\n      if (!pristine && !isInsideForm) {\n        return translate('ra.message.unsaved_changes');\n      }\n\n      return undefined;\n    });\n    return function () {\n      if (release) {\n        release();\n      }\n    };\n  }, [pristine, enable, history, translate]);\n};\n\nvar UseFormStateSubscription = {\n  // For some reason, subscribing only to pristine does not rerender when a field become dirty\n  // because it has a defaultValue (not initialValue as setting an initialValue does not make the field dirty)\n  subscription: {\n    pristine: true,\n    dirtyFields: true\n  }\n};\nexport default useWarnWhenUnsavedChanges;","map":{"version":3,"sources":["/home/roberto/Documents/Personal/test-admin/node_modules/ra-core/esm/form/useWarnWhenUnsavedChanges.js"],"names":["useEffect","useRef","useFormState","useHistory","useTranslate","useWarnWhenUnsavedChanges","enable","formRootPathname","history","translate","pristine","UseFormStateSubscription","initialLocation","location","pathname","release","block","isInsideForm","startsWith","current","undefined","subscription","dirtyFields"],"mappings":"AAAA,SAASA,SAAT,EAAoBC,MAApB,QAAkC,OAAlC;AACA,SAASC,YAAT,QAA6B,kBAA7B;AACA,SAASC,UAAT,QAA2B,kBAA3B;AACA,SAASC,YAAT,QAA6B,SAA7B;AACA;AACA;AACA;AACA;AACA;;AACA,IAAIC,yBAAyB,GAAG,UAAUC,MAAV,EAAkBC,gBAAlB,EAAoC;AAChE,MAAIC,OAAO,GAAGL,UAAU,EAAxB;AACA,MAAIM,SAAS,GAAGL,YAAY,EAA5B;AACA,MAAIM,QAAQ,GAAGR,YAAY,CAACS,wBAAD,CAAZ,CAAuCD,QAAtD;AACA,MAAIE,eAAe,GAAGX,MAAM,CAACM,gBAAgB,IAAIC,OAAO,CAACK,QAAR,CAAiBC,QAAtC,CAA5B;AACAd,EAAAA,SAAS,CAAC,YAAY;AAClB,QAAI,CAACM,MAAL,EAAa;AACT;AACH;;AACD,QAAIS,OAAO,GAAGP,OAAO,CAACQ,KAAR,CAAc,UAAUH,QAAV,EAAoB;AAC5C,UAAII,YAAY,GAAGJ,QAAQ,CAACC,QAAT,CAAkBI,UAAlB,CAA6BN,eAAe,CAACO,OAA7C,CAAnB;;AACA,UAAI,CAACT,QAAD,IAAa,CAACO,YAAlB,EAAgC;AAC5B,eAAOR,SAAS,CAAC,4BAAD,CAAhB;AACH;;AACD,aAAOW,SAAP;AACH,KANa,CAAd;AAOA,WAAO,YAAY;AACf,UAAIL,OAAJ,EAAa;AACTA,QAAAA,OAAO;AACV;AACJ,KAJD;AAKH,GAhBQ,EAgBN,CAACL,QAAD,EAAWJ,MAAX,EAAmBE,OAAnB,EAA4BC,SAA5B,CAhBM,CAAT;AAiBH,CAtBD;;AAuBA,IAAIE,wBAAwB,GAAG;AAC3B;AACA;AACAU,EAAAA,YAAY,EAAE;AAAEX,IAAAA,QAAQ,EAAE,IAAZ;AAAkBY,IAAAA,WAAW,EAAE;AAA/B;AAHa,CAA/B;AAKA,eAAejB,yBAAf","sourcesContent":["import { useEffect, useRef } from 'react';\nimport { useFormState } from 'react-final-form';\nimport { useHistory } from 'react-router-dom';\nimport { useTranslate } from '../i18n';\n/**\n * Display a confirmation dialog if the form has unsaved changes.\n * - If the user confirms, the navigation continues and the changes are lost.\n * - If the user cancels, the navigation is cancelled and the changes are kept.\n */\nvar useWarnWhenUnsavedChanges = function (enable, formRootPathname) {\n    var history = useHistory();\n    var translate = useTranslate();\n    var pristine = useFormState(UseFormStateSubscription).pristine;\n    var initialLocation = useRef(formRootPathname || history.location.pathname);\n    useEffect(function () {\n        if (!enable) {\n            return;\n        }\n        var release = history.block(function (location) {\n            var isInsideForm = location.pathname.startsWith(initialLocation.current);\n            if (!pristine && !isInsideForm) {\n                return translate('ra.message.unsaved_changes');\n            }\n            return undefined;\n        });\n        return function () {\n            if (release) {\n                release();\n            }\n        };\n    }, [pristine, enable, history, translate]);\n};\nvar UseFormStateSubscription = {\n    // For some reason, subscribing only to pristine does not rerender when a field become dirty\n    // because it has a defaultValue (not initialValue as setting an initialValue does not make the field dirty)\n    subscription: { pristine: true, dirtyFields: true },\n};\nexport default useWarnWhenUnsavedChanges;\n"]},"metadata":{},"sourceType":"module"}